<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ma Liste de Courses ðŸ›’</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon.png" />
  <meta name="theme-color" content="#111827" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 1rem;
      background: #1f2937;
      color: #f9fafb;
    }
    h1, h2 {
      text-align: center;
      color: #fbbf24;
    }
    .section-container {
      max-width: 600px;
      margin: 1rem auto;
      background: #374151;
      padding: 1rem;
      border-radius: 0.5rem;
    }
    label {
      display: block;
      margin-top: 0.5rem;
    }
    input, button {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.2rem;
      border: none;
      border-radius: 0.25rem;
      box-sizing: border-box;
    }
    button {
      margin-top: 1rem;
      background: #fbbf24;
      color: #1f2937;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background: #d19e1a;
    }

    /* Styles pour la liste d'achats */
    .shopping-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #111827;
      padding: 0.5rem 1rem;
      margin-top: 0.5rem;
      border-radius: 0.5rem;
      font-size: 1.1rem;
      color: #f9fafb;
    }
    .shopping-list-item .delete-btn {
      background: none;
      border: none;
      color: #ef4444;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0 0.5rem;
      margin: 0; /* Override default button margin */
      width: auto; /* Override default button width */
      transition: color 0.3s ease;
    }
    .shopping-list-item .delete-btn:hover {
      color: #b91c1c;
    }
    .shopping-list-item span {
        flex-grow: 1; /* Permet au texte de l'item de prendre de la place */
        padding-right: 10px; /* Espace entre le texte et la croix */
    }

    /* Styles pour la liste des suggestions */
    .suggestions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .suggestion-item {
      background: #2563eb;
      color: #f3f4f6;
      padding: 0.5rem 1rem;
      border-radius: 0.25rem;
      text-align: center;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
      white-space: nowrap; /* EmpÃªche le texte de se casser sur plusieurs lignes */
      overflow: hidden; /* Cache le texte qui dÃ©passe */
      text-overflow: ellipsis; /* Ajoute des points de suspension si le texte est trop long */
    }
    .suggestion-item:hover {
      background: #1d4ed8;
    }

    .add-suggestion-form {
        margin-top: 1.5rem;
        border-top: 1px solid #4b5563;
        padding-top: 1rem;
    }

    @media (max-width: 640px) {
        .suggestions-grid {
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        }
    }
  </style>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('Service Worker enregistrÃ©:', reg.scope))
          .catch(err => console.error('Erreur SW:', err));
      });
    }
  </script>
</head>
<body>
  <h1>Ma Liste de Courses ðŸ›’</h1>

  <div class="section-container">
    <h2>Articles Ã  acheter</h2>
    <form id="shoppingForm" autocomplete="off">
        <label for="newItem">Ajouter un article :</label>
        <input type="text" id="newItem" placeholder="Ex: Lait, Pain, Pommes..." required />
        <button type="submit">Ajouter Ã  la liste âœ…</button>
    </form>
    <div id="shoppingList" style="margin-top: 1rem;">
      </div>
  </div>

  <div class="section-container">
    <h2>Ajouter des suggestions</h2>
    <div id="suggestionsList" class="suggestions-grid">
      </div>

    <form id="addSuggestionForm" class="add-suggestion-form" autocomplete="off">
        <label for="newSuggestion">Nouvelle suggestion :</label>
        <input type="text" id="newSuggestion" placeholder="Ex: Fromage, Chocolat..." required />
        <button type="submit">Ajouter comme suggestion âœ¨</button>
    </form>
  </div>

  <script>
    const shoppingForm = document.getElementById('shoppingForm');
    const newItemInput = document.getElementById('newItem');
    const shoppingListDiv = document.getElementById('shoppingList');

    const addSuggestionForm = document.getElementById('addSuggestionForm');
    const newSuggestionInput = document.getElementById('newSuggestion');
    const suggestionsListDiv = document.getElementById('suggestionsList');

    // --- Fonctions de gestion de la liste d'achats ---

    function loadShoppingList() {
      let items = JSON.parse(localStorage.getItem('shopping_list_items')) || [];
      shoppingListDiv.innerHTML = ''; // Vide la liste actuelle

      if (items.length === 0) {
        shoppingListDiv.innerHTML = '<p style="text-align: center; color: #9ca3af;">Votre liste est vide pour l\'instant !</p>';
      }

      items.forEach((item, index) => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'shopping-list-item';
        itemDiv.innerHTML = `
          <span>${item}</span>
          <button class="delete-btn" data-index="${index}">âœ–</button>
        `;
        shoppingListDiv.appendChild(itemDiv);
      });
    }

    function addShoppingItem(item) {
      if (!item.trim()) return; // Ne pas ajouter d'Ã©lÃ©ments vides

      let items = JSON.parse(localStorage.getItem('shopping_list_items')) || [];
      // Ã‰viter les doublons simples (insensible Ã  la casse)
      if (!items.some(existingItem => existingItem.toLowerCase() === item.toLowerCase())) {
          items.push(item.trim());
          localStorage.setItem('shopping_list_items', JSON.stringify(items));
          loadShoppingList();
      } else {
          alert(`"${item}" est dÃ©jÃ  dans votre liste d'achats !`);
      }
    }

    function deleteShoppingItem(index) {
      let items = JSON.parse(localStorage.getItem('shopping_list_items')) || [];
      if (index >= 0 && index < items.length) {
        items.splice(index, 1);
        localStorage.setItem('shopping_list_items', JSON.stringify(items));
        loadShoppingList();
      }
    }

    // --- Fonctions de gestion des suggestions ---

    function loadSuggestions() {
      let suggestions = JSON.parse(localStorage.getItem('shopping_suggestions')) || [];
      suggestionsListDiv.innerHTML = ''; // Vide la liste actuelle

      if (suggestions.length === 0) {
          suggestionsListDiv.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: #9ca3af;">Ajoutez vos premiÃ¨res suggestions ci-dessous !</p>';
      }

      suggestions.forEach(suggestion => {
        const suggestionDiv = document.createElement('div');
        suggestionDiv.className = 'suggestion-item';
        suggestionDiv.textContent = suggestion;
        suggestionDiv.addEventListener('click', () => {
          addShoppingItem(suggestion); // Ajoute la suggestion Ã  la liste d'achats
        });
        suggestionsListDiv.appendChild(suggestionDiv);
      });
    }

    function addSuggestion(suggestion) {
      if (!suggestion.trim()) return; // Ne pas ajouter de suggestions vides

      let suggestions = JSON.parse(localStorage.getItem('shopping_suggestions')) || [];
      // Ã‰viter les doublons (insensible Ã  la casse)
      if (!suggestions.some(existingSuggestion => existingSuggestion.toLowerCase() === suggestion.toLowerCase())) {
          suggestions.push(suggestion.trim());
          localStorage.setItem('shopping_suggestions', JSON.stringify(suggestions));
          loadSuggestions();
      } else {
          alert(`"${suggestion}" est dÃ©jÃ  une suggestion !`);
      }
    }

    // --- Gestionnaires d'Ã©vÃ©nements ---

    shoppingForm.addEventListener('submit', e => {
      e.preventDefault();
      addShoppingItem(newItemInput.value);
      newItemInput.value = ''; // Vide le champ aprÃ¨s ajout
    });

    // Utilise la dÃ©lÃ©gation d'Ã©vÃ©nements pour le bouton de suppression
    shoppingListDiv.addEventListener('click', e => {
      if (e.target.classList.contains('delete-btn')) {
        const index = parseInt(e.target.dataset.index);
        deleteShoppingItem(index);
      }
    });

    addSuggestionForm.addEventListener('submit', e => {
      e.preventDefault();
      addSuggestion(newSuggestionInput.value);
      newSuggestionInput.value = ''; // Vide le champ aprÃ¨s ajout
    });

    // --- Initialisation au chargement de la page ---
    window.addEventListener('load', () => {
      loadShoppingList();
      loadSuggestions();
    });
  </script>
</body>
</html>