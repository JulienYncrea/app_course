<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Shopping List ğŸ›’</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon.png" />
  <meta name="theme-color" content="#FFC0CB" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 1rem;
      background: linear-gradient(to bottom right, #FAD0C4, #FFD1DC);
      color: #333;
    }
    h1, h2 {
      text-align: center;
      color: #E75480;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .section-container {
      max-width: 600px;
      margin: 1rem auto;
      background: #FFFFFF;
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      display: none;
    }
    .section-container.active {
        display: block;
    }
    label {
      display: block;
      margin-top: 0.75rem;
      font-weight: bold;
      color: #6A057F;
    }
    input, button, select {
      width: 100%;
      padding: 0.7rem;
      margin-top: 0.4rem;
      border: 1px solid #DDA0DD;
      border-radius: 0.5rem;
      box-sizing: border-box;
      color: #333;
      font-size: 1rem;
    }
    button {
      background: #FF69B4;
      color: #FFFFFF;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    button:hover {
      background: #C71585;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    select {
        background: #F8F8FF;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-image: url("data:image/svg+xml;utf8,<svg fill='%23C71585' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>");
        background-repeat: no-repeat;
        background-position: right 0.7em top 50%;
        background-size: 0.65em auto;
        padding-right: 2.5em;
    }

    /* Styles for navigation buttons */
    .navigation-buttons {
        text-align: center;
        margin-bottom: 2rem;
        display: flex;
        justify-content: center;
        gap: 1.5rem;
        flex-wrap: wrap;
    }
    .navigation-buttons button {
        width: auto;
        padding: 0.8rem 1.8rem;
        font-size: 1.1rem;
        background-color: #EE82EE;
        color: #FFFFFF;
        border: 2px solid #DA70D6;
        border-radius: 25px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .navigation-buttons button.active {
        background: #FFD700;
        color: #6A057F;
        border-color: #FFA500;
        font-weight: bold;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .navigation-buttons button:hover:not(.active) {
        background-color: #DDA0DD;
        border-color: #BA55D3;
    }

    /* Styles for the shopping list */
    .shopping-list-item, .buy-later-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #FFF0F5;
      padding: 0.7rem 1.2rem;
      margin-top: 0.7rem;
      border-radius: 0.75rem;
      font-size: 1.1rem;
      color: #6A057F;
      border: 1px solid #FFC0CB;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .shopping-list-item .delete-btn, 
    .shopping-list-item .decrement-btn,
    .buy-later-item .delete-btn {
      background: none;
      border: none;
      color: #FF6347;
      font-size: 1.6rem;
      cursor: pointer;
      padding: 0 0.5rem;
      margin: 0;
      width: auto;
      transition: color 0.3s ease;
      line-height: 1; /* Ensure consistent vertical alignment */
    }
    .shopping-list-item .decrement-btn {
        color: #6A057F; /* Darker color for decrement */
        font-size: 1.8rem; /* Slightly larger for visibility */
        margin-right: 5px; /* Space between - and quantity */
    }
    .shopping-list-item .delete-btn:hover, 
    .buy-later-item .delete-btn:hover {
      color: #DC143C;
    }
    .shopping-list-item .decrement-btn:hover {
        color: #8A2BE2; /* Change color on hover for decrement */
    }

    .shopping-list-item span, .buy-later-item span {
        flex-grow: 1;
        padding-right: 10px;
    }
    .quantity {
        font-weight: bold;
        margin-left: 8px; /* Space after quantity */
        margin-right: 8px; /* Space before quantity if decrement is present */
        color: #FF8C00;
        min-width: 20px; /* Ensure space for quantity */
        text-align: center;
    }

    /* Styles for the suggestions list */
    .suggestions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 0.7rem;
      margin-top: 1.5rem;
    }
    .suggestion-item {
      position: relative;
      background: #9370DB;
      color: #FFFFFF;
      padding: 0.6rem 1rem;
      border-radius: 0.75rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
      white-space: nowrap; /* Prevent wrapping */
      overflow: hidden; /* Hide overflow */
      text-overflow: ellipsis; /* Add ellipsis for overflowed text */
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-right: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .suggestion-item:hover {
      background: #8A2BE2;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .suggestion-item-text {
        flex-grow: 1;
        padding-right: 5px;
        font-weight: 500;
        overflow: hidden; /* Ensure text overflow ellipsis works */
        text-overflow: ellipsis;
        white-space: nowrap; /* Keep on single line */
    }
    .delete-suggestion-btn {
      background: none;
      border: none;
      color: #FFD700;
      font-size: 1.3rem;
      cursor: pointer;
      padding: 0 0.2rem;
      margin: 0;
      width: auto;
      transition: color 0.3s ease;
      line-height: 1;
      flex-shrink: 0; /* Prevent button from shrinking */
    }
    .delete-suggestion-btn:hover {
      color: #FF4500;
    }

    .add-form { /* General style for add forms */
        margin-top: 1.5rem;
        border-top: 1px solid #DDA0DD;
        padding-top: 1rem;
    }
    .filter-controls {
        margin-bottom: 1.5rem;
    }

    /* Style for empty list text */
    p[style*="text-align: center"] {
        color: #C71585 !important;
        font-style: italic;
        font-size: 0.95rem;
    }

    /* Category order list styles */
    #categoryOrderList, #manageCategoryList {
        list-style: none;
        padding: 0;
    }
    #categoryOrderList li, #manageCategoryList li {
        background: #F8F8FF;
        border: 1px solid #DDA0DD;
        padding: 0.75rem 1rem;
        margin-bottom: 0.5rem;
        border-radius: 0.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: bold;
        color: #6A057F;
        cursor: grab; /* Indicate draggable */
        transition: background-color 0.2s ease, transform 0.2s ease;
    }
    #categoryOrderList li:hover {
        background-color: #E6E6FA;
        transform: scale(1.01);
    }
    #categoryOrderList li.dragging {
        opacity: 0.7;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .drag-handle {
        font-size: 1.5rem;
        cursor: grab;
        margin-right: 10px;
        color: #EE82EE;
    }
    #manageCategoryList li .delete-category-btn {
        background: none;
        border: none;
        color: #FF6347;
        font-size: 1.2rem;
        cursor: pointer;
        padding: 0 0.2rem;
        margin-left: 10px;
        transition: color 0.3s ease;
    }
    #manageCategoryList li .delete-category-btn:hover {
        color: #DC143C;
    }

    /* Styles for the new "Manage Categories" subsection */
    .manage-categories-subsection {
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid #DDA0DD;
    }
    .manage-categories-subsection h3 {
        color: #E75480;
        text-align: center;
        margin-bottom: 1rem;
    }

    @media (max-width: 640px) {
        .suggestions-grid {
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
        }
        .navigation-buttons button {
          padding: 0.6rem 1rem;
          font-size: 0.9rem;
        }
    }
  </style>
  <script>
Â  Â  if ('serviceWorker' in navigator) {
Â  Â  Â  window.addEventListener('load', () => {
Â  Â  Â  Â  navigator.serviceWorker.register('sw.js')
Â  Â  Â  Â  Â  .then(reg => console.log('Service Worker registered:', reg.scope))
Â  Â  Â  Â  Â  .catch(err => console.error('SW error:', err));
Â  Â  Â  });
Â  Â  }
Â  </script>
</head>
<body>
Â  <h1>My Shopping List ğŸ›’</h1>

Â  <div class="navigation-buttons">
Â  Â  <button id="showShoppingListBtn" class="active">My List</button>
Â  Â  <button id="showSuggestionsBtn">Suggestions</button>
Â  Â  <button id="toggleMoreOptionsBtn" class="toggle-more-options">â–¼</button> Â  Â  <button id="showCategoryOrderBtn" class="hidden-option">Order by Category</button> Â  Â  <button id="showBuyLaterBtn" class="hidden-option">Buy Later</button> Â  </div>

Â  <div id="shoppingListSection" class="section-container active">
Â  Â  <h2>Items to Buy</h2>
Â  Â  <div id="shoppingList" style="margin-top: 1rem;">
Â  Â  Â  </div>
Â  Â  <form id="shoppingForm" autocomplete="off" class="add-form">
Â  Â  Â  Â  <label for="newItem">Add an item:</label>
Â  Â  Â  Â  <input type="text" id="newItem" placeholder="Ex: Milk, Bread, Apples..." required />
Â  Â  Â  Â  <button type="submit">Add to List âœ…</button>
Â  Â  </form>
Â  </div>

Â  <div id="suggestionsSection" class="section-container">
Â  Â  <h2>Suggestions by Category</h2>
Â  Â  <div class="filter-controls">
Â  Â  Â  Â  <label for="categoryFilter">Filter by category:</label>
Â  Â  Â  Â  <select id="categoryFilter">
Â  Â  Â  Â  Â  Â  </select>
Â  Â  </div>
Â  Â  <div id="suggestionsList" class="suggestions-grid">
Â  Â  Â  </div>

Â  Â  <form id="addSuggestionForm" autocomplete="off" class="add-form">
Â  Â  Â  Â  <label for="newSuggestion">New suggestion:</label>
Â  Â  Â  Â  <input type="text" id="newSuggestion" placeholder="Ex: Cheese, Chocolate..." required />
Â  Â  Â  Â  
Â  Â  Â  Â  <label for="suggestionCategory">Category:</label>
Â  Â  Â  Â  <select id="suggestionCategory" required>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  
Â  Â  Â  Â  <button type="submit">Add as suggestion âœ¨</button>
Â  Â  </form>
Â  </div>

Â  <div id="categoryOrderSection" class="section-container">
Â  Â  <h2>Order Categories</h2>
Â  Â  <p style="text-align: center; color: #6A057F; margin-top: 0.5rem;">Drag and drop categories to set their order in 'My List'.</p>
Â  Â  <ul id="categoryOrderList">
Â  Â  Â  Â  </ul>

Â  Â  <div class="manage-categories-subsection">
Â  Â  Â  Â  <h3>Manage Categories</h3>
Â  Â  Â  Â  <form id="addCategoryForm" autocomplete="off" class="add-form">
Â  Â  Â  Â  Â  Â  <label for="newCategoryName">Add new category:</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="newCategoryName" placeholder="Ex: Pet Food, Snacks..." required />
Â  Â  Â  Â  Â  Â  <button type="submit">Add Category â•</button>
Â  Â  Â  Â  </form>
Â  Â  Â  Â  <ul id="manageCategoryList">
Â  Â  Â  Â  Â  Â  </ul>
Â  Â  </div>
Â  </div>

Â  <div id="buyLaterSection" class="section-container">
Â  Â  <h2>Items to Buy Later</h2>
Â  Â  <div id="buyLaterList" style="margin-top: 1rem;">
Â  Â  </div>
Â  Â  <form id="buyLaterForm" autocomplete="off" class="add-form">
Â  Â  Â  Â  <label for="newBuyLaterItem">Add item to buy later:</label>
Â  Â  Â  Â  <input type="text" id="newBuyLaterItem" placeholder="Ex: New book, Fancy gadget..." required />
Â  Â  Â  Â  <button type="submit">Add to Buy Later â¡ï¸</button>
Â  Â  </form>
Â  </div>

Â  <script>
Â  Â  const shoppingForm = document.getElementById('shoppingForm');
Â  Â  const newItemInput = document.getElementById('newItem');
Â  Â  const shoppingListDiv = document.getElementById('shoppingList');

Â  Â  const addSuggestionForm = document.getElementById('addSuggestionForm');
Â  Â  const newSuggestionInput = document.getElementById('newSuggestion');
Â  Â  const suggestionCategorySelect = document.getElementById('suggestionCategory');
Â  Â  const suggestionsListDiv = document.getElementById('suggestionsList');
Â  Â  const categoryFilterSelect = document.getElementById('categoryFilter');

Â  Â  const buyLaterForm = document.getElementById('buyLaterForm');
Â  Â  const newBuyLaterItemInput = document.getElementById('newBuyLaterItem');
Â  Â  const buyLaterListDiv = document.getElementById('buyLaterList');

Â  Â  const addCategoryForm = document.getElementById('addCategoryForm');
Â  Â  const newCategoryNameInput = document.getElementById('newCategoryName');
Â  Â  const manageCategoryList = document.getElementById('manageCategoryList');

Â  Â  // Navigation buttons
Â  Â  const showShoppingListBtn = document.getElementById('showShoppingListBtn');
Â  Â  const showSuggestionsBtn = document.getElementById('showSuggestionsBtn');
Â  Â  const showCategoryOrderBtn = document.getElementById('showCategoryOrderBtn');
Â  Â  const showBuyLaterBtn = document.getElementById('showBuyLaterBtn');
Â  Â  const toggleMoreOptionsBtn = document.getElementById('toggleMoreOptionsBtn'); // Nouvelle icÃ´ne

Â  Â  // Sections
Â  Â  const shoppingListSection = document.getElementById('shoppingListSection');
Â  Â  const suggestionsSection = document.getElementById('suggestionsSection');
Â  Â  const categoryOrderSection = document.getElementById('categoryOrderSection');
Â  Â  const buyLaterSection = document.getElementById('buyLaterSection');

Â  Â  const categoryOrderList = document.getElementById('categoryOrderList');

Â  Â  // Default categories (now only for initial setup)
Â  Â  const initialDefaultCategories = [
Â  Â  Â  Â  "Petit dÃ©jeuner", "Boisson", "Viande", "Fruit", "LÃ©gume",
Â  Â  Â  Â  "Produit mÃ©nager", "Produit de beautÃ©", "Autre"
Â  Â  ];

Â  Â  // --- Category Management (core functions) ---

Â  Â  function getCategories() {
Â  Â  Â  Â  return JSON.parse(localStorage.getItem('user_categories')) || initialDefaultCategories;
Â  Â  }

Â  Â  function saveCategories(categories) {
Â  Â  Â  Â  localStorage.setItem('user_categories', JSON.stringify(categories));
Â  Â  Â  Â  updateAllCategorySelects(); // Update all selects when categories change
Â  Â  Â  Â  loadCategoryOrder(); // Update order list (also reloads manage list within it now)
Â  Â  Â  Â  loadShoppingList(); // Reload shopping list to reflect category changes
Â  Â  Â  Â  loadSuggestions(); // Reload suggestions to reflect category changes
Â  Â  }

Â  Â  function addCategory(categoryName) {
Â  Â  Â  Â  if (!categoryName.trim()) {
Â  Â  Â  Â  Â  Â  alert('Please enter a category name.');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  let categories = getCategories();
Â  Â  Â  Â  if (categories.some(cat => cat.toLowerCase() === categoryName.trim().toLowerCase())) {
Â  Â  Â  Â  Â  Â  alert(`Category "${categoryName.trim()}" already exists!`);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  categories.push(categoryName.trim());
Â  Â  Â  Â  saveCategories(categories);
Â  Â  Â  Â  newCategoryNameInput.value = '';
Â  Â  }

Â  Â  function deleteCategory(categoryName) {
Â  Â  Â  Â  if (!confirm(`Are you sure you want to delete the category "${categoryName}"? This will also remove any suggestions linked to it.`)) {
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  let categories = getCategories();
Â  Â  Â  Â  categories = categories.filter(cat => cat !== categoryName);
Â  Â  Â  Â  saveCategories(categories);

Â  Â  Â  Â  // Also delete suggestions associated with this category
Â  Â  Â  Â  let suggestions = JSON.parse(localStorage.getItem('shopping_suggestions')) || [];
Â  Â  Â  Â  suggestions = suggestions.filter(sug => sug.category !== categoryName);
Â  Â  Â  Â  localStorage.setItem('shopping_suggestions', JSON.stringify(suggestions));
Â  Â  Â  Â  loadSuggestions(); // Refresh suggestions list
Â  Â  }

Â  Â  function updateAllCategorySelects() {
Â  Â  Â  Â  const categories = getCategories();
Â  Â  Â  Â  const allCategoryOptions = ['Toutes', ...categories]; // Add 'Toutes' for filter

Â  Â  Â  Â  // Update categoryFilterSelect
Â  Â  Â  Â  categoryFilterSelect.innerHTML = '';
Â  Â  Â  Â  allCategoryOptions.forEach(cat => {
Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  option.value = cat;
Â  Â  Â  Â  Â  Â  option.textContent = cat;
Â  Â  Â  Â  Â  Â  categoryFilterSelect.appendChild(option);
Â  Â  Â  Â  });

Â  Â  Â  Â  // Update suggestionCategorySelect
Â  Â  Â  Â  suggestionCategorySelect.innerHTML = '<option value="">Choisir une catÃ©gorie</option>';
Â  Â  Â  Â  categories.forEach(cat => {
Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  option.value = cat;
Â  Â  Â  Â  Â  Â  option.textContent = cat;
Â  Â  Â  Â  Â  Â  suggestionCategorySelect.appendChild(option);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function loadManageCategories() {
Â  Â  Â  Â  const categories = getCategories();
Â  Â  Â  Â  manageCategoryList.innerHTML = '';
Â  Â  Â  Â  if (categories.length === 0) {
Â  Â  Â  Â  Â  Â  manageCategoryList.innerHTML = '<p style="text-align: center; color: #C71585; margin-top: 0.5rem;">No categories defined yet. Add some above!</p>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  categories.forEach(category => {
Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  li.textContent = category;
Â  Â  Â  Â  Â  Â  li.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <span>${category}</span>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete-category-btn" data-category="${category}">âœ–</button>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  manageCategoryList.appendChild(li);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // --- Shopping list management functions ---

    // La fonction loadShoppingList est mise Ã  jour pour gÃ©rer la suppression/dÃ©crÃ©mentation en recherchant l'Ã©lÃ©ment dans le tableau.
Â  Â  function loadShoppingList() {
Â  Â  Â  Â  let items = JSON.parse(localStorage.getItem('shopping_list_items')) || [];
Â  Â  Â  Â  const currentCategoryOrder = JSON.parse(localStorage.getItem('category_order')) || getCategories();
Â  Â  Â  Â  shoppingListDiv.innerHTML = '';

Â  Â  Â  Â  if (items.length === 0) {
Â  Â  Â  Â  Â  Â  shoppingListDiv.innerHTML = '<p style="text-align: center; color: #C71585; margin-top: 0.5rem;">Your list is empty for now!</p>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const categorizedItems = {};
Â  Â  Â  Â  currentCategoryOrder.forEach(cat => categorizedItems[cat] = []);

Â  Â  Â  Â  const itemsInOtherOrUncategorized = [];

Â  Â  Â  Â  // Sort items alphabetically before categorization
Â  Â  Â  Â  items.sort((a, b) => a.name.localeCompare(b.name, 'fr', { sensitivity: 'base' }));

Â  Â  Â  Â  items.forEach(item => {
Â  Â  Â  Â  Â  Â  const category = getCategoryForItem(item.name);
Â  Â  Â  Â  Â  Â  if (currentCategoryOrder.includes(category)) {
Â  Â  Â  Â  Â  Â  Â  Â  categorizedItems[category].push(item);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  itemsInOtherOrUncategorized.push(item);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  currentCategoryOrder.forEach(category => {
Â  Â  Â  Â  Â  Â  if (categorizedItems[category] && categorizedItems[category].length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const categoryHeader = document.createElement('h3');
Â  Â  Â  Â  Â  Â  Â  Â  categoryHeader.style.color = '#E75480';
Â  Â  Â  Â  Â  Â  Â  Â  categoryHeader.style.marginTop = '1rem';
Â  Â  Â  Â  Â  Â  Â  Â  categoryHeader.textContent = category;
Â  Â  Â  Â  Â  Â  Â  Â  shoppingListDiv.appendChild(categoryHeader);

Â  Â  Â  Â  Â  Â  Â  Â  // Sort items within each category alphabetically
Â  Â  Â  Â  Â  Â  Â  Â  categorizedItems[category].sort((a, b) => a.name.localeCompare(b.name, 'fr', { sensitivity: 'base' }));

Â  Â  Â  Â  Â  Â  Â  Â  categorizedItems[category].forEach((item) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const itemDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.className = 'shopping-list-item';
                    // Ici, au lieu d'un index, on stocke le nom et la quantitÃ© pour une identification unique
                    // Ces attributs seront utilisÃ©s par decrementShoppingItem et deleteShoppingItem
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.setAttribute('data-item-name', item.name);
                    itemDiv.setAttribute('data-item-quantity', item.quantity); // Peut Ãªtre utile pour le retrouver

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="decrement-btn" data-item-name="${item.name}">-</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="quantity">${item.quantity}x</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${item.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete-btn" data-item-name="${item.name}">âœ–</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shoppingListDiv.appendChild(itemDiv);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  if (itemsInOtherOrUncategorized.length > 0) {
Â  Â  Â  Â  Â  Â  const otherCategoryHeader = document.createElement('h3');
Â  Â  Â  Â  Â  Â  otherCategoryHeader.style.color = '#E75480';
Â  Â  Â  Â  Â  Â  otherCategoryHeader.style.marginTop = '1rem';
Â  Â  Â  Â  Â  Â  otherCategoryHeader.textContent = 'Autre / Non classÃ©';
Â  Â  Â  Â  Â  Â  shoppingListDiv.appendChild(otherCategoryHeader);

Â  Â  Â  Â  Â  Â  // Sort 'Other' items alphabetically
Â  Â  Â  Â  Â  Â  itemsInOtherOrUncategorized.sort((a, b) => a.name.localeCompare(b.name, 'fr', { sensitivity: 'base' }));

Â  Â  Â  Â  Â  Â  itemsInOtherOrUncategorized.forEach((item) => {
Â  Â  Â  Â  Â  Â  Â  Â  const itemDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.className = 'shopping-list-item';
                // MÃªme chose ici pour les attributs data
                itemDiv.setAttribute('data-item-name', item.name);
                itemDiv.setAttribute('data-item-quantity', item.quantity);
Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="decrement-btn" data-item-name="${item.name}">-</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="quantity">${item.quantity}x</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${item.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete-btn" data-item-name="${item.name}">âœ–</button>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  shoppingListDiv.appendChild(itemDiv);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function addShoppingItem(itemName) {
Â  Â  Â  if (!itemName.trim()) return;

Â  Â  Â  let items = JSON.parse(localStorage.getItem('shopping_list_items')) || [];
Â  Â  Â  const lowerCaseItemName = itemName.trim().toLowerCase();

Â  Â  Â  const existingItemIndex = items.findIndex(item => item.name.toLowerCase() === lowerCaseItemName);

Â  Â  Â  if (existingItemIndex !== -1) {
Â  Â  Â  Â  items[existingItemIndex].quantity++;
Â  Â  Â  } else {
Â  Â  Â  Â  items.push({ name: itemName.trim(), quantity: 1 });
Â  Â  Â  }

Â  Â  Â  localStorage.setItem('shopping_list_items', JSON.stringify(items));
Â  Â  Â  loadShoppingList();
Â  Â  }

    // Modification pour trouver l'Ã©lÃ©ment par son nom au lieu de l'index
Â  Â  function decrementShoppingItem(itemName) {
Â  Â  Â  Â  let items = JSON.parse(localStorage.getItem('shopping_list_items')) || [];
        const itemIndex = items.findIndex(item => item.name === itemName);

Â  Â  Â  Â  if (itemIndex !== -1) {
Â  Â  Â  Â  Â  Â  items[itemIndex].quantity--;
Â  Â  Â  Â  Â  Â  if (items[itemIndex].quantity <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  items.splice(itemIndex, 1); // Remove item if quantity is 0 or less
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  localStorage.setItem('shopping_list_items', JSON.stringify(items));
Â  Â  Â  Â  Â  Â  loadShoppingList();
Â  Â  Â  Â  }
Â  Â  }

    // Modification pour trouver l'Ã©lÃ©ment par son nom au lieu de l'index
Â  Â  function deleteShoppingItem(itemName) {
Â  Â  Â  let items = JSON.parse(localStorage.getItem('shopping_list_items')) || [];
Â  Â  Â  const itemIndex = items.findIndex(item => item.name === itemName);
Â  Â  Â  if (itemIndex !== -1) {
Â  Â  Â  Â  items.splice(itemIndex, 1);
Â  Â  Â  Â  localStorage.setItem('shopping_list_items', JSON.stringify(items));
Â  Â  Â  Â  loadShoppingList();
Â  Â  Â  }
Â  Â  }

Â  Â  function getCategoryForItem(itemName) {
Â  Â  Â  Â  const suggestions = JSON.parse(localStorage.getItem('shopping_suggestions')) || [];
Â  Â  Â  Â  const foundSuggestion = suggestions.find(sug => sug.name.toLowerCase() === itemName.toLowerCase());
Â  Â  Â  Â  return foundSuggestion ? foundSuggestion.category : 'Autre';
Â  Â  }

Â  Â  // --- Suggestions management functions ---

Â  Â  function loadSuggestions() {
Â  Â  Â  let allSuggestions = JSON.parse(localStorage.getItem('shopping_suggestions')) || [];
Â  Â  Â  suggestionsListDiv.innerHTML = '';

Â  Â  Â  const selectedCategory = categoryFilterSelect.value;
Â  Â  Â  
Â  Â  Â  let filteredSuggestions = selectedCategory === 'Toutes' 
Â  Â  Â  Â  ? allSuggestions 
Â  Â  Â  Â  : allSuggestions.filter(sug => sug.category === selectedCategory);

Â  Â  Â  // Sort filtered suggestions alphabetically
Â  Â  Â  filteredSuggestions.sort((a, b) => a.name.localeCompare(b.name, 'fr', { sensitivity: 'base' }));

Â  Â  Â  if (filteredSuggestions.length === 0) {
Â  Â  Â  Â  Â  suggestionsListDiv.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: #C71585;">No suggestions for this category. Add some below!</p>';
Â  Â  Â  }

Â  Â  Â  filteredSuggestions.forEach((suggestion) => {
Â  Â  Â  Â  const suggestionDiv = document.createElement('div');
Â  Â  Â  Â  suggestionDiv.className = 'suggestion-item';
Â  Â  Â  Â  suggestionDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  <span class="suggestion-item-text">${suggestion.name}</span>
Â  Â  Â  Â  Â  Â  <button class="delete-suggestion-btn" data-name="${suggestion.name}" data-category="${suggestion.category}">âœ–</button>
Â  Â  Â  Â  `;
Â  Â  Â  Â  
Â  Â  Â  Â  suggestionDiv.querySelector('.suggestion-item-text').addEventListener('click', () => {
Â  Â  Â  Â  Â  addShoppingItem(suggestion.name); 
Â  Â  Â  Â  });

Â  Â  Â  Â  suggestionDiv.querySelector('.delete-suggestion-btn').addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  Â  Â  const nameToDelete = e.target.dataset.name;
Â  Â  Â  Â  Â  Â  const categoryToDelete = e.target.dataset.category;
Â  Â  Â  Â  Â  Â  if (confirm(`Delete suggestion "${nameToDelete}" (${categoryToDelete})?`)) {
Â  Â  Â  Â  Â  Â  Â  Â  deleteSuggestion(nameToDelete, categoryToDelete);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  suggestionsListDiv.appendChild(suggestionDiv);
Â  Â  Â  });
Â  Â  }

Â  Â  function addSuggestion(suggestionName, category) {
Â  Â  Â  if (!suggestionName.trim() || !category.trim()) {
Â  Â  Â  Â  alert('Please enter a suggestion name AND choose a category.');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  let suggestions = JSON.parse(localStorage.getItem('shopping_suggestions')) || [];
Â  Â  Â  const lowerCaseSuggestionName = suggestionName.trim().toLowerCase();

Â  Â  Â  if (!suggestions.some(sug => sug.name.toLowerCase() === lowerCaseSuggestionName && sug.category === category)) {
Â  Â  Â  Â  Â  suggestions.push({ name: suggestionName.trim(), category: category.trim() });
Â  Â  Â  Â  Â  localStorage.setItem('shopping_suggestions', JSON.stringify(suggestions));
Â  Â  Â  Â  Â  loadSuggestions(); 
Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert(`"${suggestionName.trim()}" is already a suggestion in the "${category}" category!`);
Â  Â  Â  }
Â  Â  }

Â  Â  function deleteSuggestion(name, category) {
Â  Â  Â  Â  let suggestions = JSON.parse(localStorage.getItem('shopping_suggestions')) || [];
Â  Â  Â  Â  const updatedSuggestions = suggestions.filter(sug => !(sug.name === name && sug.category === category));
Â  Â  Â  Â  localStorage.setItem('shopping_suggestions', JSON.stringify(updatedSuggestions));
Â  Â  Â  Â  loadSuggestions();
Â  Â  }

Â  Â  // --- Buy Later list management functions ---

    // Modification pour trouver l'Ã©lÃ©ment par son nom au lieu de l'index
Â  Â  function loadBuyLaterList() {
Â  Â  Â  Â  let items = JSON.parse(localStorage.getItem('buy_later_items')) || [];
Â  Â  Â  Â  buyLaterListDiv.innerHTML = '';

Â  Â  Â  Â  if (items.length === 0) {
Â  Â  Â  Â  Â  Â  buyLaterListDiv.innerHTML = '<p style="text-align: center; color: #C71585; margin-top: 0.5rem;">Your "Buy Later" list is empty!</p>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Sort buy later items alphabetically
Â  Â  Â  Â  items.sort((a, b) => a.name.localeCompare(b.name, 'fr', { sensitivity: 'base' }));

Â  Â  Â  Â  items.forEach((item) => { // Plus besoin d'index dans le forEach si on cherche par nom
Â  Â  Â  Â  Â  Â  const itemDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  itemDiv.className = 'buy-later-item';
            // Stocke le nom de l'Ã©lÃ©ment pour le retrouver lors de la suppression
            itemDiv.setAttribute('data-item-name', item.name);
Â  Â  Â  Â  Â  Â  itemDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <span>${item.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="delete-btn" data-item-name="${item.name}">âœ–</button>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  buyLaterListDiv.appendChild(itemDiv);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function addBuyLaterItem(itemName) {
Â  Â  Â  Â  if (!itemName.trim()) return;

Â  Â  Â  Â  let items = JSON.parse(localStorage.getItem('buy_later_items')) || [];
Â  Â  Â  Â  items.push({ name: itemName.trim() });
Â  Â  Â  Â  localStorage.setItem('buy_later_items', JSON.stringify(items));
Â  Â  Â  Â  loadBuyLaterList();
Â  Â  }

    // Modification pour trouver l'Ã©lÃ©ment par son nom au lieu de l'index
Â  Â  function deleteBuyLaterItem(itemName) {
Â  Â  Â  Â  let items = JSON.parse(localStorage.getItem('buy_later_items')) || [];
        const itemIndex = items.findIndex(item => item.name === itemName);
Â  Â  Â  Â  if (itemIndex !== -1) {
Â  Â  Â  Â  Â  Â  items.splice(itemIndex, 1);
Â  Â  Â  Â  Â  Â  localStorage.setItem('buy_later_items', JSON.stringify(items));
Â  Â  Â  Â  Â  Â  loadBuyLaterList();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- Category Order management functions (Drag and Drop) ---
Â  Â  let draggedItem = null;
    let isDragging = false; // Pour gÃ©rer la diffÃ©rence entre un tap et un drag sur mobile

Â  Â  function loadCategoryOrder() {
Â  Â  Â  Â  const allAvailableCategories = getCategories();
Â  Â  Â  Â  let categoryOrder = JSON.parse(localStorage.getItem('category_order')) || allAvailableCategories;
Â  Â  Â  Â  
Â  Â  Â  Â  categoryOrder = categoryOrder.filter(cat => allAvailableCategories.includes(cat));
Â  Â  Â  Â  categoryOrder = [...new Set(categoryOrder)];
Â  Â  Â  Â  
Â  Â  Â  Â  allAvailableCategories.forEach(cat => {
Â  Â  Â  Â  Â  Â  if (!categoryOrder.includes(cat)) {
Â  Â  Â  Â  Â  Â  Â  Â  categoryOrder.push(cat);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  categoryOrderList.innerHTML = '';

Â  Â  Â  Â  if (categoryOrder.length === 0) {
Â  Â  Â  Â  Â  Â  categoryOrderList.innerHTML = '<p style="text-align: center; color: #C71585; margin-top: 0.5rem;">No categories to order. Add some in "Manage Categories" below!</p>';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  categoryOrder.forEach(category => {
Â  Â  Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  li.textContent = category;
Â  Â  Â  Â  Â  Â  Â  Â  li.setAttribute('draggable', true);
Â  Â  Â  Â  Â  Â  Â  Â  li.dataset.category = category;
Â  Â  Â  Â  Â  Â  Â  Â  li.innerHTML = `<span class="drag-handle">â ¿</span> ${category}`;

                // Ã‰vÃ©nements pour le Drag and Drop (souris)
Â  Â  Â  Â  Â  Â  Â  Â  li.addEventListener('dragstart', (e) => {
                    isDragging = true; // DÃ©but du drag
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draggedItem = li;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => li.classList.add('dragging'), 0);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  li.addEventListener('dragend', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draggedItem.classList.remove('dragging');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draggedItem = null;
                    isDragging = false; // Fin du drag
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveCategoryOrder();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadShoppingList();
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  li.addEventListener('dragover', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault(); // NÃ©cessaire pour permettre le drop
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const draggingOver = li;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const container = categoryOrderList;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const children = Array.from(container.children);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (draggedItem === draggingOver) return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const draggingOverIndex = children.indexOf(draggingOver);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const draggedItemIndex = children.indexOf(draggedItem);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const rect = draggingOver.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const offset = e.clientY - rect.top;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (draggedItemIndex < draggingOverIndex) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (offset > rect.height / 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.insertBefore(draggedItem, draggingOver.nextSibling);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (offset < rect.height / 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.insertBefore(draggedItem, draggingOver);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });


                // Ã‰vÃ©nements tactiles pour le Drag and Drop (mobile, notamment iOS)
                let touchStartX, touchStartY;
                let initialTouchClientY;
                let touchHoldTimeout; // Pour distinguer un tap d'un maintien/drag

                li.addEventListener('touchstart', (e) => {
                    // EmpÃªche le comportement par dÃ©faut de sÃ©lection de texte sur iOS
                    e.preventDefault(); 
                    // Si on commence un drag, on ne veut pas que le click se dÃ©clenche
                    isDragging = false; 
                    draggedItem = li;
                    li.classList.add('dragging'); // Ajoute la classe 'dragging' immÃ©diatement pour feedback
                    
                    const touch = e.touches[0];
                    initialTouchClientY = touch.clientY;
                    touchStartX = touch.clientX;
                    touchStartY = touch.clientY;

                    // DÃ©marre un timer, si le doigt est maintenu, on considÃ¨re que c'est un drag
                    // Sinon, si relÃ¢chÃ© rapidement, c'est un clic
                    touchHoldTimeout = setTimeout(() => {
                        isDragging = true;
                    }, 200); // Temps de maintien pour le drag (ms)
                }, { passive: false }); // `passive: false` est crucial pour `preventDefault` sur touchstart

                li.addEventListener('touchmove', (e) => {
                    // Seulement si un drag est en cours (aprÃ¨s le dÃ©lai de maintien ou si dÃ©placement significatif)
                    if (!draggedItem || !isDragging) {
                        // Si le mouvement est significatif avant le timeout, on le transforme en drag
                        const touch = e.touches[0];
                        if (Math.abs(touch.clientY - touchStartY) > 5 || Math.abs(touch.clientX - touchStartX) > 5) {
                            clearTimeout(touchHoldTimeout); // Annule le timeout du tap
                            isDragging = true;
                        } else {
                            return; // Pas encore un drag
                        }
                    }

                    e.preventDefault(); // EmpÃªche le scroll par dÃ©faut lors du drag
                    const touch = e.touches[0];
                    const draggingOver = li;
                    const container = categoryOrderList;
                    const children = Array.from(container.children);

                    if (draggedItem === draggingOver) return;

                    const draggingOverIndex = children.indexOf(draggingOver);
                    const draggedItemIndex = children.indexOf(draggedItem);

                    const rect = draggingOver.getBoundingClientRect();
                    const offset = touch.clientY - rect.top;

                    if (draggedItemIndex < draggingOverIndex) {
                        if (offset > rect.height / 2) {
                            container.insertBefore(draggedItem, draggingOver.nextSibling);
                        }
                    } else {
                        if (offset < rect.height / 2) {
                            container.insertBefore(draggedItem, draggingOver);
                        }
                    }
                }, { passive: false });

                li.addEventListener('touchend', () => {
                    clearTimeout(touchHoldTimeout); // Assure que le timeout est nettoyÃ©
                    if (draggedItem) {
                        draggedItem.classList.remove('dragging');
                        draggedItem = null;
                        saveCategoryOrder();
                        loadShoppingList();
                    }
                    isDragging = false;
                });
                
Â  Â  Â  Â  Â  Â  Â  Â  categoryOrderList.appendChild(li);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  saveCategoryOrder();
Â  Â  Â  Â  loadManageCategories();
Â  Â  }

Â  Â  function saveCategoryOrder() {
Â  Â  Â  Â  const order = Array.from(categoryOrderList.children).map(li => li.dataset.category);
Â  Â  Â  Â  localStorage.setItem('category_order', JSON.stringify(order));
Â  Â  }


Â  Â  // --- Section navigation functions ---
Â  Â  function showSection(sectionToShow) {
Â  Â  Â  Â  // Hide all sections
Â  Â  Â  Â  shoppingListSection.classList.remove('active');
Â  Â  Â  Â  suggestionsSection.classList.remove('active');
Â  Â  Â  Â  categoryOrderSection.classList.remove('active');
Â  Â  Â  Â  buyLaterSection.classList.remove('active');

Â  Â  Â  Â  // Remove 'active' class from all navigation buttons
Â  Â  Â  Â  showShoppingListBtn.classList.remove('active');
Â  Â  Â  Â  showSuggestionsBtn.classList.remove('active');
Â  Â  Â  Â  showCategoryOrderBtn.classList.remove('active');
Â  Â  Â  Â  showBuyLaterBtn.classList.remove('active');

Â  Â  Â  Â  // Show the desired section and update the active button
Â  Â  Â  Â  if (sectionToShow === 'shoppingList') {
Â  Â  Â  Â  Â  Â  shoppingListSection.classList.add('active');
Â  Â  Â  Â  Â  Â  showShoppingListBtn.classList.add('active');
Â  Â  Â  Â  Â  Â  loadShoppingList();
Â  Â  Â  Â  } else if (sectionToShow === 'suggestions') {
Â  Â  Â  Â  Â  Â  suggestionsSection.classList.add('active');
Â  Â  Â  Â  Â  Â  showSuggestionsBtn.classList.add('active');
Â  Â  Â  Â  Â  Â  updateAllCategorySelects();
Â  Â  Â  Â  Â  Â  loadSuggestions();
Â  Â  Â  Â  } else if (sectionToShow === 'categoryOrder') {
Â  Â  Â  Â  Â  Â  categoryOrderSection.classList.add('active');
Â  Â  Â  Â  Â  Â  showCategoryOrderBtn.classList.add('active');
Â  Â  Â  Â  Â  Â  loadCategoryOrder();
Â  Â  Â  Â  } else if (sectionToShow === 'buyLater') {
Â  Â  Â  Â  Â  Â  buyLaterSection.classList.add('active');
Â  Â  Â  Â  Â  Â  showBuyLaterBtn.classList.add('active');
Â  Â  Â  Â  Â  Â  loadBuyLaterList();
Â  Â  Â  Â  }
Â  Â  }

    // Fonction pour basculer la visibilitÃ© des boutons "Order by Category" et "Buy Later"
    let moreOptionsVisible = false;
    function toggleMoreOptions() {
        moreOptionsVisible = !moreOptionsVisible;
        if (moreOptionsVisible) {
            showCategoryOrderBtn.style.display = 'block'; // Ou 'inline-block', 'flex', etc. selon votre CSS
            showBuyLaterBtn.style.display = 'block';
            toggleMoreOptionsBtn.textContent = 'â–²'; // FlÃ¨che vers le haut
        } else {
            showCategoryOrderBtn.style.display = 'none';
            showBuyLaterBtn.style.display = 'none';
            toggleMoreOptionsBtn.textContent = 'â–¼'; // FlÃ¨che vers le bas

            // Si l'une des sections cachÃ©es Ã©tait active, on revient Ã  la liste principale
            if (categoryOrderSection.classList.contains('active') || buyLaterSection.classList.contains('active')) {
                showSection('shoppingList');
            }
        }
    }


Â  Â  // --- Event handlers ---

Â  Â  shoppingForm.addEventListener('submit', e => {
Â  Â  Â  e.preventDefault();
Â  Â  Â  addShoppingItem(newItemInput.value);
Â  Â  Â  newItemInput.value = '';
Â  Â  });

    // Les Ã©couteurs d'Ã©vÃ©nements pour le dÃ©crÃ©ment et la suppression sont modifiÃ©s
    // pour utiliser `e.target.dataset.itemName`
Â  Â  shoppingListDiv.addEventListener('click', e => {
Â  Â  Â  if (e.target.classList.contains('delete-btn')) {
Â  Â  Â  Â  const itemName = e.target.dataset.itemName;
Â  Â  Â  Â  deleteShoppingItem(itemName);
Â  Â  Â  } else if (e.target.classList.contains('decrement-btn')) {
Â  Â  Â  Â  const itemName = e.target.dataset.itemName;
Â  Â  Â  Â  decrementShoppingItem(itemName);
Â  Â  Â  }
Â  Â  });

Â  Â  addSuggestionForm.addEventListener('submit', e => {
Â  Â  Â  e.preventDefault();
Â  Â  Â  const newSugName = newSuggestionInput.value;
Â  Â  Â  const sugCategory = suggestionCategorySelect.value;
Â  Â  Â  
Â  Â  Â  if (!sugCategory) {
Â  Â  Â  Â  Â  alert("Please select a category for the suggestion.");
Â  Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  addSuggestion(newSugName, sugCategory);
Â  Â  Â  newSuggestionInput.value = '';
Â  Â  });

Â  Â  categoryFilterSelect.addEventListener('change', loadSuggestions);

Â  Â  buyLaterForm.addEventListener('submit', e => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  addBuyLaterItem(newBuyLaterItemInput.value);
Â  Â  Â  Â  newBuyLaterItemInput.value = '';
Â  Â  });

    // L'Ã©couteur d'Ã©vÃ©nement pour la suppression est modifiÃ©
Â  Â  buyLaterListDiv.addEventListener('click', e => {
Â  Â  Â  Â  if (e.target.classList.contains('delete-btn')) {
Â  Â  Â  Â  Â  Â  const itemName = e.target.dataset.itemName;
Â  Â  Â  Â  Â  Â  deleteBuyLaterItem(itemName);
Â  Â  Â  Â  }
Â  Â  });

Â  Â  addCategoryForm.addEventListener('submit', e => {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  addCategory(newCategoryNameInput.value);
Â  Â  });

Â  Â  manageCategoryList.addEventListener('click', e => {
Â  Â  Â  Â  if (e.target.classList.contains('delete-category-btn')) {
Â  Â  Â  Â  Â  Â  const categoryToDelete = e.target.dataset.category;
Â  Â  Â  Â  Â  Â  deleteCategory(categoryToDelete);
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // Event handlers for navigation buttons
Â  Â  showShoppingListBtn.addEventListener('click', () => showSection('shoppingList'));
Â  Â  showSuggestionsBtn.addEventListener('click', () => showSection('suggestions'));
    toggleMoreOptionsBtn.addEventListener('click', toggleMoreOptions); // Nouvel Ã©couteur
Â  Â  showCategoryOrderBtn.addEventListener('click', () => showSection('categoryOrder'));
Â  Â  showBuyLaterBtn.addEventListener('click', () => showSection('buyLater'));

Â  Â  // --- Initialization on page load ---
Â  Â  window.addEventListener('load', () => {
Â  Â  Â  if (!localStorage.getItem('user_categories')) {
Â  Â  Â  Â  Â  localStorage.setItem('user_categories', JSON.stringify(initialDefaultCategories));
Â  Â  Â  }
Â  Â  Â  if (!localStorage.getItem('category_order')) {
Â  Â  Â  Â  Â  localStorage.setItem('category_order', JSON.stringify(getCategories()));
Â  Â  Â  }

Â  Â  Â  updateAllCategorySelects();
Â  Â  Â  loadShoppingList();
Â  Â  Â  loadSuggestions();
Â  Â  Â  loadBuyLaterList();
Â  Â  Â  loadCategoryOrder(); 

Â  Â  Â  showSection('shoppingList'); // Affiche la liste d'achats par dÃ©faut
      // Cache les boutons supplÃ©mentaires au chargement
      showCategoryOrderBtn.style.display = 'none';
      showBuyLaterBtn.style.display = 'none';
Â  Â  });
Â  </script>
</body>
</html>