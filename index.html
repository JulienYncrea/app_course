<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ma Liste de Courses üõí</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon.png" />
  <meta name="theme-color" content="#FFC0CB" /> <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Police plus douce */
      margin: 0; padding: 1rem;
      background: linear-gradient(to bottom right, #FAD0C4, #FFD1DC); /* D√©grad√© doux */
      color: #333; /* Texte plus sombre pour le contraste */
    }
    h1, h2 {
      text-align: center;
      color: #E75480; /* Rose vif */
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1); /* Petite ombre pour la profondeur */
    }
    .section-container {
      max-width: 600px;
      margin: 1rem auto;
      background: #FFFFFF; /* Fond blanc pur pour la lisibilit√© */
      padding: 1.5rem; /* Augmenter un peu le padding */
      border-radius: 1rem; /* Bords plus arrondis */
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Ombre plus douce */
      display: none; 
    }
    .section-container.active {
        display: block;
    }
    label {
      display: block;
      margin-top: 0.75rem; /* Espacement ajust√© */
      font-weight: bold;
      color: #6A057F; /* Violet fonc√© */
    }
    input, button, select {
      width: 100%;
      padding: 0.7rem; /* Augmenter le padding */
      margin-top: 0.4rem; /* Espacement ajust√© */
      border: 1px solid #DDA0DD; /* Bordure violette claire */
      border-radius: 0.5rem; /* Bords plus arrondis */
      box-sizing: border-box;
      color: #333;
      font-size: 1rem;
    }
    button {
      background: #FF69B4; /* Rose bonbon */
      color: #FFFFFF; /* Texte blanc */
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease; /* Transition plus globale */
      border: none; /* Pas de bordure par d√©faut */
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Ombre l√©g√®re pour les boutons */
    }
    button:hover {
      background: #C71585; /* Rose plus fonc√© au survol */
      transform: translateY(-2px); /* L√©ger soul√®vement */
      box-shadow: 0 4px 8px rgba(0,0,0,0.2); /* Ombre plus prononc√©e */
    }
    select {
        background: #F8F8FF; /* Fond lavande tr√®s clair */
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-image: url("data:image/svg+xml;utf8,<svg fill='%23C71585' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/><path d='M0 0h24v24H0z' fill='none'/></svg>"); /* Fl√®che rose */
        background-repeat: no-repeat;
        background-position: right 0.7em top 50%;
        background-size: 0.65em auto;
        padding-right: 2.5em;
    }

    /* Styles pour les boutons de navigation */
    .navigation-buttons {
        text-align: center;
        margin-bottom: 2rem; /* Plus d'espace */
        display: flex;
        justify-content: center;
        gap: 1.5rem; /* Espacement accru */
    }
    .navigation-buttons button {
        width: auto; 
        padding: 0.8rem 1.8rem; /* Padding plus g√©n√©reux */
        font-size: 1.1rem; /* Texte plus grand */
        background-color: #EE82EE; /* Violet moyen par d√©faut */
        color: #FFFFFF;
        border: 2px solid #DA70D6; /* Bordure assortie */
        border-radius: 25px; /* Forme pilule */
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .navigation-buttons button.active {
        background: #FFD700; /* Or vif pour l'actif */
        color: #6A057F; /* Texte violet fonc√© sur or */
        border-color: #FFA500; /* Bordure orange dor√© */
        font-weight: bold;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .navigation-buttons button:hover:not(.active) {
        background-color: #DDA0DD; /* Violet plus clair au survol */
        border-color: #BA55D3;
    }

    /* Styles pour la liste d'achats */
    .shopping-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #FFF0F5; /* Rose p√¢le */
      padding: 0.7rem 1.2rem; /* Padding g√©n√©reux */
      margin-top: 0.7rem; /* Espacement ajust√© */
      border-radius: 0.75rem; /* Bords tr√®s arrondis */
      font-size: 1.1rem;
      color: #6A057F; /* Texte violet fonc√© */
      border: 1px solid #FFC0CB; /* Bordure rose claire */
      box-shadow: 0 2px 4px rgba(0,0,0,0.05); /* Ombre tr√®s l√©g√®re */
    }
    .shopping-list-item .delete-btn {
      background: none;
      border: none;
      color: #FF6347; /* Rouge tomate pour le bouton de suppression */
      font-size: 1.6rem; /* Plus grand */
      cursor: pointer;
      padding: 0 0.5rem;
      margin: 0;
      width: auto;
      transition: color 0.3s ease;
    }
    .shopping-list-item .delete-btn:hover {
      color: #DC143C; /* Rouge cramoisi au survol */
    }
    .shopping-list-item span {
        flex-grow: 1;
        padding-right: 10px;
    }
    .quantity {
        font-weight: bold;
        margin-right: 8px;
        color: #FF8C00; /* Orange fonc√© pour la quantit√© */
    }

    /* Styles pour la liste des suggestions */
    .suggestions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); /* Taille min un peu plus grande */
      gap: 0.7rem; /* Espacement accru */
      margin-top: 1.5rem;
    }
    .suggestion-item {
      position: relative;
      background: #9370DB; /* Violet moyen */
      color: #FFFFFF; /* Texte blanc */
      padding: 0.6rem 1rem;
      border-radius: 0.75rem; /* Bords tr√®s arrondis */
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-right: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .suggestion-item:hover {
      background: #8A2BE2; /* Violet plus intense au survol */
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .suggestion-item-text {
        flex-grow: 1;
        padding-right: 5px;
        font-weight: 500;
    }
    .delete-suggestion-btn {
      background: none;
      border: none;
      color: #FFD700; /* Or pour le bouton de suppression de suggestion */
      font-size: 1.3rem;
      cursor: pointer;
      padding: 0 0.2rem;
      margin: 0;
      width: auto;
      transition: color 0.3s ease;
      line-height: 1;
    }
    .delete-suggestion-btn:hover {
      color: #FF4500; /* Orange rouge au survol */
    }

    .add-suggestion-form {
        margin-top: 2rem; /* Plus d'espace */
        border-top: 1px solid #DDA0DD; /* Bordure rose claire */
        padding-top: 1.5rem;
    }
    .filter-controls {
        margin-bottom: 1.5rem;
    }

    /* Style pour le texte de liste vide */
    p[style*="text-align: center"] {
        color: #C71585 !important; /* Rose fonc√© pour le texte vide */
        font-style: italic;
        font-size: 0.95rem;
    }

    @media (max-width: 640px) {
        .suggestions-grid {
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
        }
        .navigation-buttons button {
          padding: 0.6rem 1rem;
          font-size: 0.9rem;
        }
    }
  </style>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('Service Worker enregistr√©:', reg.scope))
          .catch(err => console.error('Erreur SW:', err));
      });
    }
  </script>
</head>
<body>
  <h1>Ma Liste de Courses üõí</h1>

  <div class="navigation-buttons">
    <button id="showShoppingListBtn" class="active">Ma Liste</button>
    <button id="showSuggestionsBtn">Suggestions</button>
  </div>

  <div id="shoppingListSection" class="section-container active">
    <h2>Articles √† acheter</h2>
    <div id="shoppingList" style="margin-top: 1rem;"> 
      </div>
    <form id="shoppingForm" autocomplete="off">
        <label for="newItem">Ajouter un article :</label>
        <input type="text" id="newItem" placeholder="Ex: Lait, Pain, Pommes..." required />
        <button type="submit">Ajouter √† la liste ‚úÖ</button>
    </form>
  </div>

  <div id="suggestionsSection" class="section-container">
    <h2>Suggestions par cat√©gorie</h2>
    <div class="filter-controls">
        <label for="categoryFilter">Filtrer par cat√©gorie :</label>
        <select id="categoryFilter">
            <option value="Toutes">Toutes les cat√©gories</option>
            <option value="Petit d√©jeuner">Petit d√©jeuner</option>
            <option value="Boisson">Boisson</option>
            <option value="Viande">Viande</option>
            <option value="Fruit">Fruit</option>
            <option value="L√©gume">L√©gume</option>
            <option value="Produit m√©nager">Produit m√©nager</option>
            <option value="Produit de beaut√©">Produit de beaut√©</option>
            <option value="Autre">Autre</option>
        </select>
    </div>
    <div id="suggestionsList" class="suggestions-grid">
      </div>

    <form id="addSuggestionForm" class="add-suggestion-form" autocomplete="off">
        <label for="newSuggestion">Nouvelle suggestion :</label>
        <input type="text" id="newSuggestion" placeholder="Ex: Fromage, Chocolat..." required />
        
        <label for="suggestionCategory">Cat√©gorie :</label>
        <select id="suggestionCategory" required>
            <option value="">Choisir une cat√©gorie</option>
            <option value="Petit d√©jeuner">Petit d√©jeuner</option>
            <option value="Boisson">Boisson</option>
            <option value="Viande">Viande</option>
            <option value="Fruit">Fruit</option>
            <option value="L√©gume">L√©gume</option>
            <option value="Produit m√©nager">Produit m√©nager</option>
            <option value="Produit de beaut√©">Produit de beaut√©</option>
            <option value="Autre">Autre</option>
        </select>
        
        <button type="submit">Ajouter comme suggestion ‚ú®</button>
    </form>
  </div>

  <script>
    const shoppingForm = document.getElementById('shoppingForm');
    const newItemInput = document.getElementById('newItem');
    const shoppingListDiv = document.getElementById('shoppingList');

    const addSuggestionForm = document.getElementById('addSuggestionForm');
    const newSuggestionInput = document.getElementById('newSuggestion');
    const suggestionCategorySelect = document.getElementById('suggestionCategory');
    const suggestionsListDiv = document.getElementById('suggestionsList');
    const categoryFilterSelect = document.getElementById('categoryFilter');

    // Nouveaux √©l√©ments pour la navigation
    const showShoppingListBtn = document.getElementById('showShoppingListBtn');
    const showSuggestionsBtn = document.getElementById('showSuggestionsBtn');
    const shoppingListSection = document.getElementById('shoppingListSection');
    const suggestionsSection = document.getElementById('suggestionsSection');

    // --- Fonctions de gestion de la liste d'achats ---

    function loadShoppingList() {
      let items = JSON.parse(localStorage.getItem('shopping_list_items')) || [];
      shoppingListDiv.innerHTML = '';

      if (items.length === 0) {
        shoppingListDiv.innerHTML = '<p style="text-align: center; color: #9ca3af; margin-top: 0.5rem;">Votre liste est vide pour l\'instant !</p>';
      }

      items.forEach((item, index) => {
        const itemDiv = document.createElement('div');
        itemDiv.className = 'shopping-list-item';
        const quantityDisplay = item.quantity > 1 ? `<span class="quantity">${item.quantity}x</span>` : '';
        itemDiv.innerHTML = `
          ${quantityDisplay}<span>${item.name}</span>
          <button class="delete-btn" data-index="${index}">‚úñ</button>
        `;
        shoppingListDiv.appendChild(itemDiv);
      });
    }

    function addShoppingItem(itemName) {
      if (!itemName.trim()) return;

      let items = JSON.parse(localStorage.getItem('shopping_list_items')) || [];
      const lowerCaseItemName = itemName.trim().toLowerCase();

      const existingItemIndex = items.findIndex(item => item.name.toLowerCase() === lowerCaseItemName);

      if (existingItemIndex !== -1) {
        items[existingItemIndex].quantity++;
      } else {
        items.push({ name: itemName.trim(), quantity: 1 });
      }

      localStorage.setItem('shopping_list_items', JSON.stringify(items));
      
      loadShoppingList(); 
    }

    function deleteShoppingItem(index) {
      let items = JSON.parse(localStorage.getItem('shopping_list_items')) || [];
      if (index >= 0 && index < items.length) {
        items.splice(index, 1);
        localStorage.setItem('shopping_list_items', JSON.stringify(items));
        loadShoppingList(); 
      }
    }

    // --- Fonctions de gestion des suggestions ---

    function loadSuggestions() {
      let allSuggestions = JSON.parse(localStorage.getItem('shopping_suggestions')) || [];
      suggestionsListDiv.innerHTML = '';

      const selectedCategory = categoryFilterSelect.value;
      
      const filteredSuggestions = selectedCategory === 'Toutes' 
        ? allSuggestions 
        : allSuggestions.filter(sug => sug.category === selectedCategory);

      if (filteredSuggestions.length === 0) {
          suggestionsListDiv.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: #9ca3af;">Aucune suggestion pour cette cat√©gorie. Ajoutez-en ci-dessous !</p>';
      }

      filteredSuggestions.forEach((suggestion) => {
        const suggestionDiv = document.createElement('div');
        suggestionDiv.className = 'suggestion-item';
        suggestionDiv.innerHTML = `
            <span class="suggestion-item-text">${suggestion.name}</span>
            <button class="delete-suggestion-btn" data-name="${suggestion.name}" data-category="${suggestion.category}">‚úñ</button>
        `;
        
        suggestionDiv.querySelector('.suggestion-item-text').addEventListener('click', () => {
          addShoppingItem(suggestion.name); 
        });

        suggestionDiv.querySelector('.delete-suggestion-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            const nameToDelete = e.target.dataset.name;
            const categoryToDelete = e.target.dataset.category;
            if (confirm(`Supprimer la suggestion "${nameToDelete}" (${categoryToDelete}) ?`)) {
                deleteSuggestion(nameToDelete, categoryToDelete);
            }
        });

        suggestionsListDiv.appendChild(suggestionDiv);
      });
    }

    function addSuggestion(suggestionName, category) {
      if (!suggestionName.trim() || !category.trim()) {
        alert('Veuillez entrer un nom de suggestion ET choisir une cat√©gorie.');
        return;
      }

      let suggestions = JSON.parse(localStorage.getItem('shopping_suggestions')) || [];
      const lowerCaseSuggestionName = suggestionName.trim().toLowerCase();

      if (!suggestions.some(sug => sug.name.toLowerCase() === lowerCaseSuggestionName && sug.category === category)) {
          suggestions.push({ name: suggestionName.trim(), category: category.trim() });
          localStorage.setItem('shopping_suggestions', JSON.stringify(suggestions));
          loadSuggestions(); 
      } else {
          alert(`"${suggestionName.trim()}" est d√©j√† une suggestion dans la cat√©gorie "${category}" !`);
      }
    }

    function deleteSuggestion(name, category) {
        let suggestions = JSON.parse(localStorage.getItem('shopping_suggestions')) || [];
        const updatedSuggestions = suggestions.filter(sug => !(sug.name === name && sug.category === category));
        localStorage.setItem('shopping_suggestions', JSON.stringify(updatedSuggestions));
        loadSuggestions();
    }

    // --- Fonctions de navigation entre les sections ---
    function showSection(sectionToShow) {
        // Masque toutes les sections
        shoppingListSection.classList.remove('active');
        suggestionsSection.classList.remove('active');

        // Retire la classe 'active' de tous les boutons de navigation
        showShoppingListBtn.classList.remove('active');
        showSuggestionsBtn.classList.remove('active');

        // Affiche la section d√©sir√©e et met √† jour le bouton actif
        if (sectionToShow === 'shoppingList') {
            shoppingListSection.classList.add('active');
            showShoppingListBtn.classList.add('active');
        } else if (sectionToShow === 'suggestions') {
            suggestionsSection.classList.add('active');
            showSuggestionsBtn.classList.add('active');
        }
    }

    // --- Gestionnaires d'√©v√©nements ---

    shoppingForm.addEventListener('submit', e => {
      e.preventDefault();
      addShoppingItem(newItemInput.value);
      newItemInput.value = '';
    });

    shoppingListDiv.addEventListener('click', e => {
      if (e.target.classList.contains('delete-btn')) {
        const index = parseInt(e.target.dataset.index);
        deleteShoppingItem(index);
      }
    });

    addSuggestionForm.addEventListener('submit', e => {
      e.preventDefault();
      const newSugName = newSuggestionInput.value;
      const sugCategory = suggestionCategorySelect.value;
      
      if (!sugCategory) {
          alert("Veuillez s√©lectionner une cat√©gorie pour la suggestion.");
          return;
      }

      addSuggestion(newSugName, sugCategory);
      newSuggestionInput.value = '';
    });

    categoryFilterSelect.addEventListener('change', loadSuggestions);

    // Gestionnaires d'√©v√©nements pour les boutons de navigation
    showShoppingListBtn.addEventListener('click', () => showSection('shoppingList'));
    showSuggestionsBtn.addEventListener('click', () => showSection('suggestions'));

    // --- Initialisation au chargement de la page ---
    window.addEventListener('load', () => {
      loadShoppingList();
      loadSuggestions();
      // Afficher la liste de courses par d√©faut au chargement
      showSection('shoppingList'); 
    });
  </script>
</body>
</html>